@model List<Practica6.MVC.Models.ShippersView>

@{
    ViewBag.Title = "Shippers Page";
}

<h1 class="mb-4">Shippers</h1>

<div>
    <button type="button" class="btn btn-outline-secondary" onclick="window.location.href='@Url.Action("Insert", "Shippers")'">
        Create a new Suppliers <i class="bi bi-plus"></i>
    </button>
</div>

<div class="table-responsive">
    <table class="table table-striped table-hover">
        <thead>
            <tr>
                <th scope="col" class="p-3">Company Name</th>
                <th scope="col" class="p-3">Phone</th>
                <th scope="col" class="p-3">Delete</th>
                <th scope="col" class="p-3">Edit</th>
            </tr>
        </thead>
        <tbody>
            @foreach (var shippers in Model)
            {
                <tr>

                    <td class="p-3">
                        <span id="companyName_@shippers.ShipperID">@shippers.CompanyName</span>
                        <input type="text" id="editCompanyName_@shippers.ShipperID" value="@shippers.CompanyName" class="form-control" style="display: none;" />
                    </td>
                    <td class="p-3">
                        <span id="phone_@shippers.ShipperID">@shippers.Phone</span>
                        <input type="text" id="editPhone_@shippers.ShipperID" value="@shippers.Phone" class="form-control" style="display: none;" />
                    </td>
                    <td class="p-3">
                        <button type="button" class="btn btn-outline-danger" onclick="deleteShipper(@shippers.ShipperID)">
                            <i class="bi bi-trash3"></i>
                        </button>
                    </td>
                    <td class="p-3">
                        <button id="editButton_@shippers.ShipperID" type="button" class="btn btn-outline-secondary" onclick="editShipper(@shippers.ShipperID)">
                            <i class="bi bi-pen"></i>
                        </button>
                        <button class="btn btn-success" style="display: none;" data-id="@shippers.ShipperID" onclick="saveShipper(@shippers.ShipperID)">
                            <i class="bi bi-check-lg"></i>
                        </button>
                    </td>
                </tr>
            }
        </tbody>
    </table>
</div>


@section Scripts{
    <script type="text/javascript" charset="utf-8">
        function deleteShipper(idShipper) {

            Swal.fire({
                title: 'Are you sure?',
                text: "You won't be able to revert this operation!",
                icon: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#3085d6',
                cancelButtonColor: '#d33',
                cancelButtonText: 'Cancel',
                confirmButtonText: 'Yes, Delete!',
            }).then((result) => {
                if (result.isConfirmed) {
                    confirmDelete(idShipper);
                    Swal.fire(
                        'Deleted!',
                        'The shipper has been deleted.',
                        'success'
                    )
                }
            });
        }

        function confirmDelete(idShipper) {
            $.ajax({
                url: '@Url.Action("DeleteShipper", "Shippers")',
                method: 'POST',
                data: {
                    idShipper: idShipper,
                },
                dataType: "json",
                success: function (data) {
                    if (data.result) {
                        Swal.fire(
                            'Good!',
                            'Shipper removed!',
                            'success'
                        );

                        window.location.reload();
                    } else {
                        Swal.fire(
                            'Error!',
                            'Could not delete. Error: ' + data.error,
                            'error'
                        );
                    }
                },
                error: function (xhr, textStatus, errorThrown) {
                    console.error(xhr);
                }
            });
        }

        function editShipper(idShipper) {
            $(`#phone_${idShipper}`).hide();
            $(`#editPhone_${idShipper}`).show();
            $(`#companyName_${idShipper}`).hide();
            $(`#editCompanyName_${idShipper}`).show();

            $(`#editButton_${idShipper}`).css('display', 'none');

            $(`button[data-id="${idShipper}"].btn-success`).show();
        }

        function saveShipper(idShipper) {
            var newPhone = $(`#editPhone_${idShipper}`).val();
            var newCompanyName = $(`#editCompanyName_${idShipper}`).val();

            $.ajax({
                url: '@Url.Action("Edit", "Shippers")',
                method: 'POST',
                data: {
                    ShipperID: idShipper,
                    CompanyName: newCompanyName,
                    Phone: newPhone,
                },
                success: function (data) {
                    if (data.result) {

                        Swal.fire(
                            'Success!',
                            'Shipper updated successfully',
                            'success'
                        )
                            .then(() => {
                                window.location.reload();
                            });

                    } else {
                        console.log(data);
                        Swal.fire(
                            'Error!',
                            'Failed to update shipper. Error: ' + data.error,
                            'error'
                        );
                    }
                },
                error: function (xhr, textStatus, errorThrown) {
                    console.error(xhr);
                    Swal.fire(
                        'Error!',
                        'An error occurred while updating the shipper: ' + errorThrown,
                        'error'
                    );
                }
            });


        }

    </script>
}