@model List<Practica6.MVC.Models.SupplierView>


@{
    ViewBag.Title = "Suppliers Page";
}

<h1>Suppliers</h1>

<div>
    <button type="button" class="btn btn-outline-secondary" onclick="window.location.href='@Url.Action("Insert", "Suppliers")'">
        Create a new Suppliers <i class="bi bi-plus"></i>
    </button>
</div>

<div class="table-responsive">
    <table class="table table-striped table-hover">
        <thead>
            <tr>
                <th scope="col" class="p-3">Company Name</th>
                <th scope="col" class="p-3">Cantact Name</th>
                <th scope="col" class="p-3">Contact Title</th>
                <th scope="col" class="p-3">Address</th>
                <th scope="col" class="p-3">City</th>
                <th scope="col" class="p-3">Region</th>
                <th scope="col" class="p-3">Postal Code</th>
                <th scope="col" class="p-3">Country</th>
                <th scope="col" class="p-3">Phone</th>
                <th scope="col" class="p-3">Fax</th>
                <th scope="col" class="p-3">Opciones</th>
            </tr>
        </thead>
        <tbody>
            @foreach (var supplier in Model)
            {
                <tr>
                    <td class="p-3">@supplier.CompanyName</td>
                    <td class="p-3">@supplier.ContactName</td>
                    <td class="p-3">@supplier.ContactTitle</td>
                    <td class="p-3">@supplier.Address</td>
                    <td class="p-3">@supplier.City</td>
                    <td class="p-3">@supplier.Region</td>
                    <td class="p-3">@supplier.PostalCode</td>
                    <td class="p-3">@supplier.Country</td>
                    <td class="p-3">@supplier.Phone</td>
                    <td class="p-3">@supplier.Fax</td>
                    <td>
                        <button type="button" class="btn btn-outline-danger" onclick="deleteSupplier(@supplier.SupplierID)">
                            <i class="bi bi-trash3"></i>
                        </button>
                    </td>
                </tr>
            }
        </tbody>
    </table>
</div>



@section Scripts{
    <script type="text/javascript" charset="utf-8">
        function deleteSupplier(idSupplier) {

            Swal.fire({
                title: '¿Está seguro?',
                text: "No podrás revertir esta operación!",
                icon: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#3085d6',
                cancelButtonColor: '#d33',
                cancelButtonText: 'Cancelar',
                confirmButtonText: 'Si, Eliminar!',
            }).then((result) => {
                if (result.isConfirmed) {
                    console.log("mandó a eliminar");
                    confirmDelete(idSupplier);
                    Swal.fire(
                        'Deleted!',
                        'the suppliers has been deleted.',
                        'success'
                    )
                }
            });
        }

        function confirmDelete(idSupplier) {
            $.ajax({
                url: '@Url.Action("DeleteSuppliers", "Suppliers")',
                method: 'POST',
                data: {
                    idSuppliers: idSupplier,
                },
                dataType: "json",
                success: function (data) {
                    if (data.result) {
                        Swal.fire(
                            'Bien!',
                            'Proveedor eliminado!',
                            'success'
                        );

                        window.location.reload();
                    } else {
                        Swal.fire(
                            'Error!',
                            'No se pudo eliminar. Error: ' + data.error,
                            'error'
                        );
                    }
                },
                error: function (xhr, textStatus, errorThrown) {
                    console.error(xhr);
                }
            });
        }
    </script>
}