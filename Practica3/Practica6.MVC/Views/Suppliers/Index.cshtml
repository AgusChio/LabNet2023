@model List<Practica6.MVC.Models.SupplierView>




<h1>Suppliers</h1>

<div>
    <button type="button" class="btn btn-outline-secondary" onclick="window.location.href='@Url.Action("Insert", "Suppliers")'">
        Create a new Suppliers <i class="bi bi-plus"></i>
    </button>
</div>

<div class="table-responsive">
    <table class="table table-striped table-hover">
        <thead>
            <tr>
                <th scope="col" class="p-3">Company Name</th>
                <th scope="col" class="p-3">Cantact Name</th>
                <th scope="col" class="p-3">Contact Title</th>
                <th scope="col" class="p-3">Address</th>
                <th scope="col" class="p-3">City</th>
                <th scope="col" class="p-3">Region</th>
                <th scope="col" class="p-3">Postal Code</th>
                <th scope="col" class="p-3">Country</th>
                <th scope="col" class="p-3">Phone</th>
                <th scope="col" class="p-3">Fax</th>
                <th scope="col" class="p-3">Delete</th>
                <th scope="col" class="p-3">Edit</th>
            </tr>
        </thead>
        <tbody>
            @foreach (var supplier in Model)
            {
                <tr>
                    <td class="p-3">
                        <span id="companyName_@supplier.SupplierID">@supplier.CompanyName</span>
                        <input type="text" id="editCompanyName_@supplier.SupplierID" value="@supplier.CompanyName" class="form-control" style="display: none;" />
                    </td>
                    <td class="p-3">
                        <span id="contactName_@supplier.SupplierID">@supplier.ContactName</span>
                        <input type="text" id="editContactName_@supplier.SupplierID" value="@supplier.ContactName" class="form-control" style="display: none;" />
                    </td>

                    <td class="p-3">
                        <span id="contactTitle_@supplier.SupplierID">@supplier.ContactTitle</span>
                        <input type="text" id="editContactTitle_@supplier.SupplierID" value="@supplier.ContactTitle" class="form-control" style="display: none;" />
                    </td>

                    <td class="p-3">
                        <span id="address_@supplier.SupplierID">@supplier.Address</span>
                        <input type="text" id="editAddress_@supplier.SupplierID" value="@supplier.Address" class="form-control" style="display: none;" />
                    </td>

                    <td class="p-3">
                        <span id="city_@supplier.SupplierID">@supplier.City</span>
                        <input type="text" id="editCity_@supplier.SupplierID" value="@supplier.City" class="form-control" style="display: none;" />
                    </td>
                    <td class="p-3">
                        <span id="region_@supplier.SupplierID">@supplier.Region</span>
                        <input type="text" id="editRegion_@supplier.SupplierID" value="@supplier.Region" class="form-control" style="display: none;" />
                    </td>
                    <td class="p-3">
                        <span id="postalCode_@supplier.SupplierID">@supplier.PostalCode</span>
                        <input type="text" id="editPostalCode_@supplier.SupplierID" value="@supplier.PostalCode" class="form-control" style="display: none;" />
                    </td>

                    <td class="p-3">
                        <span id="country_@supplier.SupplierID">@supplier.Country</span>
                        <input type="text" id="editCountry_@supplier.SupplierID" value="@supplier.Country" class="form-control" style="display: none;" />
                    </td>

                    <td class="p-3">
                        <span id="phone_@supplier.SupplierID">@supplier.Phone</span>
                        <input type="text" id="editPhone_@supplier.SupplierID" value="@supplier.Phone" class="form-control" style="display: none;" />
                    </td>
                    <td class="p-3">
                        <span id="fax_@supplier.SupplierID">@supplier.Fax</span>
                        <input type="text" id="editFax_@supplier.SupplierID" value="@supplier.Fax" class="form-control" style="display: none;" />
                    </td>
                    <td class="p-3">
                        <button type="button" class="btn btn-outline-danger" onclick="deleteSupplier(@supplier.SupplierID)">
                            <i class="bi bi-trash3"></i>
                        </button>
                    </td>
                    <td class="p-3">
                        <button id="editButton_@supplier.SupplierID" type="button" class="btn btn-outline-secondary" onclick="editSupplier(@supplier.SupplierID)">
                            <i class="bi bi-pen"></i>
                        </button>
                        <button class="btn btn-success" style="display: none;" data-id="@supplier.SupplierID" onclick="saveSupplier(@supplier.SupplierID)">
                            <i class="bi bi-check-lg"></i>
                        </button>
                    </td>
                </tr>
            }
        </tbody>
    </table>
</div>



@section Scripts{
    <script type="text/javascript" charset="utf-8">
        function deleteSupplier(idSupplier) {

            Swal.fire({
                title: 'Are you sure?',
                text: "You won't be able to revert this operation!",
                icon: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#3085d6',
                cancelButtonColor: '#d33',
                cancelButtonText: 'Cancel',
                confirmButtonText: 'Yes, Delete!',
            }).then((result) => {
                if (result.isConfirmed) {
                    confirmDelete(idSupplier);
                    Swal.fire(
                        'Deleted!',
                        'The suppliers has been deleted.',
                        'success'
                    )
                }
            });
        }

        function confirmDelete(idSupplier) {
            $.ajax({
                url: '@Url.Action("DeleteSupplier", "Suppliers")',
                method: 'POST',
                data: {
                    idSupplier: idSupplier,
                },
                dataType: "json",
                success: function (data) {
                    if (data.result) {
                        Swal.fire(
                            'Good!',
                            'Provider removed!',
                            'success'
                        );

                        window.location.reload();
                    } else {
                        Swal.fire(
                            'Error!',
                            'Could not delete. Error: ' + data.error,
                            'error'
                        );
                    }
                },
                error: function (xhr, textStatus, errorThrown) {
                    console.error(xhr);
                }
            });
        }

        function editSupplier(idSupplier) {
            $(`#region_${idSupplier}`).hide();
            $(`#editRegion_${idSupplier}`).show();
            $(`#fax_${idSupplier}`).hide();
            $(`#editFax_${idSupplier}`).show();
            $(`#contactName_${idSupplier}`).hide();
            $(`#editContactName_${idSupplier}`).show();
            $(`#contactTitle_${idSupplier}`).hide();
            $(`#editContactTitle_${idSupplier}`).show();
            $(`#address_${idSupplier}`).hide();
            $(`#editAddress_${idSupplier}`).show();
            $(`#city_${idSupplier}`).hide();
            $(`#editCity_${idSupplier}`).show();
            $(`#postalCode_${idSupplier}`).hide();
            $(`#editPostalCode_${idSupplier}`).show();
            $(`#country_${idSupplier}`).hide();
            $(`#editCountry_${idSupplier}`).show();
            $(`#phone_${idSupplier}`).hide();
            $(`#editPhone_${idSupplier}`).show();
            $(`#companyName_${idSupplier}`).hide();
            $(`#editCompanyName_${idSupplier}`).show();

            $(`#editButton_${idSupplier}`).css('display', 'none');

            $(`button[data-id="${idSupplier}"].btn-success`).show();

            console.log(idSupplier);
        }

        function saveSupplier(idSupplier) {
            var newRegion = $(`#editRegion_${idSupplier}`).val();
            var newFax = $(`#editFax_${idSupplier}`).val();
            var newContactName = $(`#editContactName_${idSupplier}`).val();
            var newContactTitle = $(`#editContactTitle_${idSupplier}`).val();
            var newAddress = $(`#editAddress_${idSupplier}`).val();
            var newCity = $(`#editCity_${idSupplier}`).val();
            var newPostalCode = $(`#editPostalCode_${idSupplier}`).val();
            var newCountry = $(`#editCountry_${idSupplier}`).val();
            var newPhone = $(`#editPhone_${idSupplier}`).val();
            var newCompanyName = $(`#editCompanyName_${idSupplier}`).val();

            $.ajax({
                url: '@Url.Action("Edit", "Suppliers")',
                method: 'POST',
                data: {
                    SupplierID: idSupplier,
                    CompanyName: newCompanyName,
                    ContactName: newContactName,
                    ContactTitle: newContactTitle,
                    Address: newAddress,
                    City: newCity,
                    Region: newRegion,
                    PostalCode: newPostalCode,
                    Country: newCountry,
                    Phone: newPhone,
                    Fax: newFax,
                },
                success: function (data) {
                    if (data.result) {

                        Swal.fire(
                            'Success!',
                            'Supplier updated successfully',
                            'success'
                        )
                            .then(() => {
                                window.location.reload();
                            });

                    } else {
                        console.log(data);
                        Swal.fire(
                            'Error!',
                            'Failed to update supplier. Error: ' + data.error,
                            'error'
                        );
                    }
                },
                error: function (xhr, textStatus, errorThrown) {
                    console.error(xhr);
                    Swal.fire(
                        'Error!',
                        'An error occurred while updating the supplier: ' + errorThrown,
                        'error'
                    );
                }
            });


        }

    </script>
}